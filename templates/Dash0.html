{% extends "base.html" %}
{% block map %}

<div id="mapwin" class="innertube">

  <div id="iframe-container">

    <iframe id="iframe1" src="{{ url_for('thru', path=mapfile) }}"></iframe>
  </div>
    <!-- Login Screen -->
    <div id="loginScreen">
        <h2>Login</h2>
        <input type="password" id="password" placeholder="Enter password" class="form-control mb-2">
        <button id="loginBtn" type="button" class="btn btn-primary mb-2">Login</button>
        <div id="loginMessage"></div>
    </div>

    <!-- Calendar Container -->
    <div id="calendar">
        <div id="calendar-header" class="container-fluid text-center">
            <h2 id="calendar-title" class="mb-2">
                {{ current_election }} Campaigns Calendar
            </h2>

            <div id="calendar-controls" class="d-flex justify-content-center gap-2 flex-wrap mb-2">
                <button id="switch-tomap-btn" class="btn btn-tomap">üß≠ Map</button>
                <button id="save-calendar-btn" class="btn btn-primary">üíæ Save Calendar</button>
                <button id="generate-summary-btn" class="btn btn-secondary">üìã Generate Table</button>
                <button id="export-html-btn" class="btn btn-info">üîê Export HTML</button>
            </div>
        </div>

        <div id="calendar-scroll" class="container-fluid">
            <div id="calendar-grid" class="calendar-grid mt-4"></div>
            <div id="summary-report" class="mt-4"></div>
        </div>
    </div>
</div>


<div id="map-overlay" class="map-overlay">
<div id="map-overlay-container" class="map-overlay-container">
    <iframe id="overlay-iframe" class="overlay-iframe" src=""></iframe>
    <button id="close-overlay" class="overlay-close-btn">Close Map</button>
</div>
</div>
{% endblock map %}

{% block modals %}
<!-- Modal -->
<div class="modal fade" id="slotModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Modal header -->
            <div id="modalPopup" class="modal-header">
                <h5 class="modal-title">Edit Slot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

                <!-- Main slot form -->
                <form id="slotForm">

                    <!-- Activity -->
                    <div class="mb-2">
                        <label>Activity</label>
                        <select id="activitySelect" class="form-select"></select>
                        <button id="addTaskTagBtn" type="button" class="btn btn-sm btn-primary mt-1">‚ûï Add Task Tag</button>
                    </div>

                    <!-- Hidden mini-form for adding a task tag -->
                    <div id="addTaskTagForm" class="border p-2 mt-2 d-none">
                        <h6>New Task Tag</h6>
                        <input id="newTagCode" class="form-control mb-1" placeholder="Tag code">
                        <input id="newTagLabel" class="form-control mb-1" placeholder="Tag label">
                        <button id="saveNewTag" type="button" class="btn btn-success btn-sm mt-1">Save Tag</button>
                    </div>

                    <!-- Resources -->
                    <div class="mb-2">
                        <label>Resources</label>
                        <select id="resourcesSelect" class="form-select" multiple></select>
                        <button id="addResourceBtn" type="button" class="btn btn-sm btn-primary mt-1">‚ûï Add Resource</button>
                    </div>

                    <!-- Hidden mini-form for adding a resource -->
                    <div id="addResourceForm" class="border p-2 mt-2 d-none">
                        <h6>New Resource</h6>
                        <input id="newResFirst" class="form-control mb-1" placeholder="First name">
                        <input id="newResLast" class="form-control mb-1" placeholder="Surname">
                        <input id="newResEmail" class="form-control mb-1" placeholder="Email">
                        <button id="saveNewResource" type="button" class="btn btn-success btn-sm mt-1">Save Resource</button>
                    </div>

                    <!-- Place -->
                    <div class="mb-2">
                        <label>Place</label>
                        <select id="placeSelect" class="form-select"></select>
                        <button id="addPlaceBtn" type="button" class="btn btn-sm btn-primary mt-1">
                            ‚ûï Add Place
                        </button>
                    </div>

                    <!-- Hidden mini-form for adding a place -->
                    <div id="addPlaceForm" class="border p-2 mt-2 d-none">
                        <h6>New Place</h6>
                        <input id="newPlacePrefix" class="form-control mb-1" placeholder="Prefix (e.g., Four Points Hotel)">
                        <input id="newPlaceAddress1" class="form-control mb-1" placeholder="Address line 1">
                        <input id="newPlaceAddress2" class="form-control mb-1" placeholder="City / Town">
                        <input id="newPlacePostcode" class="form-control mb-1" placeholder="Postcode">
                        <input id="newPlaceURL" class="form-control mb-1" placeholder="Website URL (optional)">
                        <button id="saveNewPlace" type="button" class="btn btn-success btn-sm mt-1">Save Place</button>
                    </div>


                    <!-- Area -->
                    <div class="mb-2">
                        <label>Area</label>

                        <!-- Selected areas summary -->
                        <select id="areaSelect" class="form-select mb-2" multiple></select>

                        <!-- Accordion container -->
                        <div id="areaAccordionContainer"
                             class="border rounded p-2"
                             style="max-height: 300px; overflow-y: auto;">
                            <!-- Example of injected HTML -->
                            <!-- Each area button gets .area-option and data attributes -->
                            <!-- This will be dynamically populated -->
                            <!--
                            <button type="button" class="btn btn-sm btn-outline-primary area-option mb-1"
                                    data-fid="area1"
                                    data-name="Downtown">
                                Downtown
                            </button>
                            -->
                        </div>
                    </div>



                </form>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-danger" id="clearSlotBtn">Clear Slot</button>
                <button class="btn btn-primary" id="saveSlotBtn">Save</button>
            </div>

        </div>
    </div>
</div>

{% endblock modals %}

{% block log %}
<div id="logwin" >

    <div class="log-content innertube">
      <!-- Your flash messages and status messages -->
      <!-- Log content here -->
        <h3>elecTrek flash messages: </h3>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="flashes">
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}
          <h3>elecTrek status messages: </h3>
            <ul class="flashes" >
            {% for pessage in pessages %}
              <li> {{ pessage  }}</li>
            {% endfor %}
            </ul>
    </div>
</div>
{% endblock log %}
{% block nav %}

<div id="nav">

    <!-- Navigation content here -->

  <h3>Election Dashboard</h3>
  <ul class="centred" >user: {{ session['username'] }}</ul>
  <ul class="nav nav-tabs" id="election-tabs">
    {% for election_name in ELECTIONS %}
      <li class="nav-item position-relative tab-item">
        <button class="nav-link election-tab {% if election_name == current_election %}active{% endif %}"
                data-election="{{ election_name }}"
                onclick="switchElection('{{ election_name }}')">
          {{ election_name }}
        </button>
        <span class="delete-tab-btn"
              data-election="{{ election_name }}"
              onclick="deleteElection('{{ election_name }}')">√ó</span>
      </li>
    {% endfor %}
    <li class="nav-item">
      <button class="nav-link" id="add-election-tab" style="font-weight: bold;" onclick="addElection()">ÔºãNEW</button>
    </li>
  </ul>


      <div id="constants-container">
      <ul>
        <li class="righted" hidden>
          <select class="righted"name="streams" id="streams" ></select><br>
      </li>
      <li class="righted">
        Type of Election: <select class="righted"name="territories" id="territories"></select><br>
      </li>
      <li class="righted">
      Party selected: <select class="righted" name="yourparty" id="yourparty"></select><br>
      </li>
      <li class="righted">
      Walk Size: <input class="righted" type="number" min="100" max="500" step="50" name="walksize" id="walksize" /><br>
      </li>
      <li class="righted">
      Team Size: <input class="righted" type="number" min="1" max="25" step="1" name="teamsize" id="teamsize" /><br>
      </li>
      <li class="righted">
      GOTV: <input class="righted" type="number" id="GOTV" name="GOTV" min="0.01" max="0.99" step="0.01"  />
      </li>
      <li class="righted">
        <div class="toggle-container">
          <span class="toggle-label">Accumulate: </span>
          <label class="switch">
            <input type="checkbox" id="accumulate" name="accumulate" onchange="handleToggle(this)">
            <span class="slider"></span>
          </label>
        </div>
      </li>
      <li class="righted">
      Bookmarks: <select class="righted" name="mapfiles" id="mapfiles" ></select><br>
      </li>
      <li class="righted">
        <label id="resources-toggle" style="cursor: pointer;">Resources ‚¨á</label>
        <div id="resources-container" style="display: none; position: absolute; background: white; border: 1px solid #ccc; padding: 5px;">
          <select name="resources" id="resources" multiple size="5"></select>
        </div>
      </li>
      <li class="righted" >
      Candidate: <select class="righted" name="candidate" id="candidate" ></select><br>
        </li>
      <li class="righted" >
      Campaign Mgr: <select class="righted" name="campaignMgr" id="campaignMgr" ></select><br>
      </li>
      <li class="righted" >
      Email: <input class="righted" name="campaignMgremail" id="campaignMgremail" readonly></input><br>
      </li>
      <li class="righted" >
      Mobile: <select class="righted" name="mobile" id="mobile" ></select><br>
      </li>
      <li class="righted" >
      Prev.Party: <select class="righted" name="previousParty" id="previousParty" disabled></select><br>
      </li>
      <li class="righted">
          Date of election:
          <input
          class="righted"
          type="date"
          id="electiondate"
          name="electiondate"
          />
      </li>
      </ul>
</div>
        <div class = "grid-container">
          <div class="grid-item">
          <button type="button" id="b0" class="small_btn">SPARE<br>SPARE</button>
          </div>
            <div class="grid-item">
              <button type = "button" id = "b1" class = "small_btn" onclick="setActionForm('filelist',filelist='maps')">Boundary<br>Maps</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b2" class = "small_btn" onclick="window.open('/election-report', '_blank')">ELECTIONS<br>REPORT</button>
            </div>
            <div class="grid-item">
              <button type="button" id="b3" class="small_btn" >ELECTORAL<br>REGISTERS</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b4" class = "small_btn">ACTIVITY<br>DELIVERY</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b5" class = "small_btn">CAMPAIGN PROGRESS</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b9" class = "small_btn">CALENDAR</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b6" class = "small_btn">VOTER<br>TELLING</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b7" class = "small_btn" >ELECTOR<br>SEARCH</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "b8" class = "small_btn" >BROWSE<br>TERRITORY</button>
            </div>
            <div class="grid-item">
              <button type = "button" id = "logout-button" class = "small_btn" >LOGOUT</button>
            </div>

          </div>
    <div id="chartContainer" style="width: 300px; height: 300px; position: relative;">
      <canvas id="streamChart"></canvas>
    </div>
</div>
{% endblock nav %}
{% block captains %}

<div id="datawin" class="innertube">

  <div id="tabletitle">
    <span id="selectedTitle">Table Details</span>
    <select id="tableSelector">
      {% for key, value in table_types.items() %}
      <option value="{{ key }}">{{ value }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="table-container">
    <table id="captains-table" style="width: 100%; table-layout: fixed;">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

</div>


{% endblock captains %}
{% block script %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
{% endblock script %}
